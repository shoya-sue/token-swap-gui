# Orcaトークンスワップ計算機 - 要件定義書

## 1. プロジェクト概要

### 目的
OrcaのAMM（自動マーケットメーカー）プールを活用したリアルタイムトークンスワップ計算機を構築する。

### コンセプト
- ウォレット接続後に利用可能なシングルページアプリケーション
- Orcaプールの実際のレートを使用したスワップ計算
- 手数料込みの正確な受取量表示

## 2. 機能要件

### 2.1 ウォレット接続機能
- **必須対応ウォレット**
  - Phantom
  - Solflare
  - Backpack
- **接続状態表示**
  - ウォレットアドレスの短縮表示
  - 接続/切断ボタン
  - 接続状態のインジケーター

### 2.2 トークン選択機能
- **FROM/TOトークン選択**
  - ドロップダウンまたはモーダル形式
  - トークンアイコン + シンボル + 名前表示
  - 検索機能（シンボル・名前による絞り込み）
- **対応トークン**
  - SOL, USDC, USDT, mSOL, stSOL, BONK, WIF
  - Orcaで取引量の多い主要ペア（20-30種類）
- **スワップ方向切り替え**
  - ワンクリックでFROM/TOを入れ替え

### 2.3 残高表示機能
- **ユーザー保有残高**
  - 選択中のFROMトークンの保有量表示
  - 「最大」ボタンで全量入力
  - 残高不足時の警告表示

### 2.4 スワップ計算機能
- **リアルタイム計算**
  - 入力量に応じた受取量の即座計算
  - Orcaプールの実際のレートを使用
  - 0.3%のプール手数料を含む正確な計算
- **スリッページ設定**
  - 0.1%, 0.5%, 1.0%, カスタム設定
  - スリッページ込みの最小受取量表示
- **プライスインパクト表示**
  - 大口取引時の価格影響度
  - 警告レベル（2%以上で注意、5%以上で警告）

### 2.5 プール情報表示
- **使用プール情報**
  - プール名（例：SOL-USDC）
  - 流動性総額（TVL）
  - 24時間取引量
  - APR（手数料収益率）
- **レート情報**
  - 現在のスワップレート
  - 24時間変動率

### 2.6 取引実行機能
- **スワップ実行**
  - Orca SDKを使用した実際のスワップ
  - トランザクション確認画面
  - 実行後の成功/失敗通知
- **取引設定**
  - ガス代の見積もり表示
  - 優先手数料の設定オプション

## 3. UI/UX要件

### 3.1 レイアウト構成
```
┌─────────────────────────────────────┐
│ ヘッダー (ロゴ + ウォレット接続)      │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────────┐ │
│  │     メインスワップエリア        │ │
│  │  FROM: [トークン] [金額入力]    │ │
│  │    残高: 1,234.56 SOL [MAX]     │ │
│  │              ↕                  │ │
│  │  TO:   [トークン] [受取量]      │ │
│  │                                 │ │
│  │  スリッページ: [0.5%] [設定]   │ │
│  │  プライスインパクト: 0.12%     │ │
│  │                                 │ │
│  │     [スワップ実行ボタン]        │ │
│  └─────────────────────────────────┘ │
│                                     │
│  ┌─────────────────────────────────┐ │
│  │        プール詳細情報           │ │
│  │  使用プール: SOL-USDC Whirlpool │ │
│  │  TVL: $12.5M | 24h Vol: $2.1M  │ │
│  │  レート: 1 SOL = 98.45 USDC    │ │
│  └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### 3.2 デザインガイドライン
- **カラーテーマ**
  - プライマリ: Orcaブランドカラー（青系）
  - セカンダリ: アクセント用（緑/赤）
  - 背景: ダークモード対応
- **レスポンシブ対応**
  - デスクトップ: 1200px以上
  - タブレット: 768px-1199px
  - モバイル: 767px以下

### 3.3 インタラクション
- **入力時リアルタイム更新**
  - 0.5秒のデバウンス処理
  - ローディングインジケーター
- **エラーハンドリング**
  - トースト通知によるエラー表示
  - 入力値検証とリアルタイムエラー表示

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: React 18+ with TypeScript
- **スタイリング**: Tailwind CSS
- **状態管理**: React Query + Zustand
- **ウォレット接続**: @solana/wallet-adapter

### 4.2 Solana関連ライブラリ
- **基本**: @solana/web3.js
- **Orca統合**: @orca-so/whirlpools-sdk
- **トークン**: @solana/spl-token

### 4.3 API連携
- **RPC接続**: Helius / QuickNode
- **価格データ**: Orca APIまたはJupiter API
- **トークンメタデータ**: Solana Token List

## 5. パフォーマンス要件

### 5.1 応答性能
- 初回ロード: 3秒以内
- 計算更新: 500ms以内
- トランザクション実行: 30秒以内

### 5.2 データ更新頻度
- プール情報: 10秒間隔
- 残高更新: トランザクション後即座
- 価格データ: 5秒間隔

## 6. セキュリティ要件

### 6.1 入力検証
- 数値入力の範囲チェック
- 残高不足の事前チェック
- SQLインジェクション対策

### 6.2 ウォレット セキュリティ
- 秘密鍵の非保存
- トランザクション内容の明示
- フィッシング対策の注意喚起

## 7. 開発フェーズ

### Phase 1: 基本機能（2週間）
- ウォレット接続
- 基本的なスワップ計算
- 主要トークンペア対応

### Phase 2: 高度な機能（1週間）
- プール情報表示
- スリッページ設定
- エラーハンドリング強化

### Phase 3: 最適化（1週間）
- パフォーマンス改善
- UIブラッシュアップ
- テスト強化

## 8. 今後の拡張性

### 将来実装予定
- 取引履歴の表示
- チャート機能
- より多くのトークンペア対応
- ルーティング最適化
- モバイルアプリ化